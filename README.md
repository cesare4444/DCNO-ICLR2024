# [ICLR 2024] Dilated convolution neural operator for multiscale partial differential equations

##  Datasets
The data of experiment darcy flow is generated by the code of [Zongyi Li (Caltech)](https://github.com/zongyi-li/fourier_neural_operator). Download the following data from [here](https://drive.google.com/drive/folders/1qSqVtW7eVTTojz-_Ic7n7dO_NevOWzEs?usp=drive_link):
<br>`darcy_rough_train.mat`
<br>`darcy_rough_val.mat`
<br>`darcy_rough_test.mat`

The data of the multiscale trigonometric coefficients can be downloaded from [here](https://mega.nz/folder/nJ0zVKqJ#YFjqWNUy_6F9i7ZM8VNhMg):
<br>`gamblet_train.mat`
<br>`gamblet_val.mat`
<br>`gamblet_test.mat`

The data of Navier-Stokes equation is generated by the code of [Zongyi Li (Caltech)](https://github.com/zongyi-li/fourier_neural_operator). Download the following data from [here](https://drive.google.com/drive/folders/1qSqVtW7eVTTojz-_Ic7n7dO_NevOWzEs?usp=drive_link):
<br>`NS64_1e-6_T15_train.mat`
<br>`NS64_1e-6_T15_train.mat`
<br>`NS64_1e-6_T15_train.mat`

More datasets in Table2 can be generated by [ns_2d.py](https://github.com/cesare4444/DCNO-ICLR2024/blob/main/DCNO/data_generation/navier_stokes/ns_2d.py).

## Environment Requirement(python=3.8.13, pytorch=1.13.1+cu116)
```bash
conda env create -f environment.yaml
```

##  Training
Please put all the datasets into the ./data folder.

Run the 'ex_darcy.py' to reproduce the  darcy flow forward experiment by
```train
python ex_darcy.py  
```
  
Run the 'ex_trigonometric.py' to reproduce the multiscale trigonometric coefficients forward experiment by
```train
python ex_trigonometric.py 
```

Run the 'ex_NS.py' to reproduce the Navier-Stokes experiment by
```train
python ex_NS.py 
```
To reproduce the inverse problem experiments, see the comment of [ex_darcy.py](https://github.com/cesare4444/DCNO-ICLR2024/blob/main/DCNO/ex_darcy.py)  and [ex_trigonometric.py](https://github.com/cesare4444/DCNO-ICLR2024/blob/main/DCNO/ex_trigonometric.py)

## Evaluation
To evaluate DCNO model, run:

```eval
python eval.py 
```
details can be seen on the comment of [eval.py](https://github.com/cesare4444/DCNO-ICLR2024/blob/main/DCNO/eval.py)
The result(.mat) file will be generated under the ./results folder. 

##  Pre-trained models
You can download pretrained models [here](https://drive.google.com/drive/folders/1R25krLJahly9RZJYIEpEqkpWy4DOBTwx?usp=sharing):
- [darcy_res256_forward.pt](https://drive.google.com/file/d/1vXIBtRGnVcIDKkeDSXVWPsI6ARtrMk1W/view?usp=drive_link) trained on darcy flow in section 4.1 with resolution=256.
- [gamblet_res256_forward.pt](https://drive.google.com/file/d/1DUEP9CHxyNh9BrGKPVLbBCXIWT5gcC6e/view?usp=drive_link) trained on multiscale trigonometric coefficients in section 4.1 with resolution=256.
- [darcy_res256_inverse_noise0.0.pt](https://drive.google.com/file/d/1F6pv8LSDZ9yXyOfp9DccWqVN-2pP6w0U/view?usp=drive_link) trained on darcy flow inverse problem with noise=0.0 in section 4.3 with resolution=256.
- [darcy_res256_inverse_noise0.1.pt](https://drive.google.com/file/d/1YKaAoeVWc7u2G17wbzFrpYO8bzuJnRUW/view?usp=drive_link) trained on darcy flow inverse problem with noise=0.1 in section 4.3 with resolution=256.
- [gamblet_res256_inverse_noise0.0.pt](https://drive.google.com/file/d/1LdhNOZkEYSpwsSOSOm633yX7ss25XzU-/view?usp=drive_link) trained on multiscale trigonometric coefficients inverse problem with noise=0.0 in section 4.3 with resolution=256.
- [gamblet_res256_inverse_noise0.1.pt](https://drive.google.com/file/d/1HAxAwQXdQyUysuEKaiWZEaeOLtBPIm1-/view?usp=drive_link) trained on multiscale trigonometric coefficients inverse problem with noise=0.1 in section 4.3 with resolution=256.
- [NS64_1e-6_T15.pt](https://drive.google.com/file/d/1b4cMxns8l_Ck3wYLyKXigOJ66Q4mSD9n/view?usp=drive_link) trained on Navier-Stokes equation with v=1e-6, T_in=10, T=15 in section 4.2.


Put them in the ./models folder.
