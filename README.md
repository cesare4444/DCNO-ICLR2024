# [ICLR 2024] Dilated convolution neural operator for multiscale partial differential equations

##  Datasets
The data of experiment darcy flow is generated by the code of [Zongyi Li (Caltech)](https://github.com/zongyi-li/fourier_neural_operator). Download the following data from [here](https://drive.google.com/drive/folders/1qSqVtW7eVTTojz-_Ic7n7dO_NevOWzEs?usp=drive_link):
<br>`darcy_rough_train.mat`
<br>`darcy_rough_val.mat`
<br>`darcy_rough_test.mat`

The data of the multiscale trigonometric coefficients can be downloaded from [here](https://mega.nz/folder/nJ0zVKqJ#YFjqWNUy_6F9i7ZM8VNhMg):
<br>`gamblet_train.mat`
<br>`gamblet_val.mat`
<br>`gamblet_test.mat`

The data of Navier-Stokes equation is generated by the code of [Zongyi Li (Caltech)](https://github.com/zongyi-li/fourier_neural_operator). Download the following data from [here](https://drive.google.com/drive/folders/1qSqVtW7eVTTojz-_Ic7n7dO_NevOWzEs?usp=drive_link):
<br>`NS64_1e-6_T15_train.mat`
<br>`NS64_1e-6_T15_train.mat`
<br>`NS64_1e-6_T15_train.mat`

More datasets in Table2 can be generated by [ns_2d.py](https://github.com/cesare4444/DCNO-ICLR2024/blob/main/DCNO/data_generation/navier_stokes/ns_2d.py).

## Environment Requirement(python=3.8.13, pytorch=1.13.1+cu116)
```bash
conda env create -f environment.yaml
```

##  Training
Please put all the datasets into the ./data folder.

Run the 'ex_darcy.py' to reproduce the  darcy flow forward experiment by
```train
python ex_darcy.py  
```
  
Run the 'ex_trigonometric.py' to reproduce the multiscale trigonometric coefficients forward experiment by
```train
python ex_trigonometric.py 
```

Run the 'ex_NS.py' to reproduce the Navier-Stokes experiment by
```train
python ex_NS.py 
```
To reproduce the inverse problem experiments, see the comment of [ex_darcy.py](https://github.com/cesare4444/DCNO-ICLR2024/blob/main/DCNO/ex_darcy.py)  and [ex_trigonometric.py](https://github.com/cesare4444/DCNO-ICLR2024/blob/main/DCNO/ex_trigonometric.py)

## Evaluation
To evaluate DCNO model, run:

```eval
python eval.py 
```
details can be seen on the comment of [eval.py](https://github.com/cesare4444/DCNO-ICLR2024/blob/main/DCNO/ex_darcy.py)  and [ex_trigonometric.py](https://github.com/cesare4444/DCNO-ICLR2024/blob/main/DCNO/eval.py)
The result(.mat) file will be generated under the ./results folder. 

##  Pre-trained models
You can download pretrained models [here](https://drive.google.com/drive/folders/1Tnjh7Vnr_lmdYpePl60ZHuYTzfcz_8Zl?usp=share_link):
- [darcyrough_res256.pt](https://drive.google.com/file/d/14GQMdM573oCNIJNWO_pcvUpTim7vmw0O/view?usp=share_link) trained on darcy rough in section 4.2 with resolution=256.
- [multiscale_res256.pt](https://drive.google.com/file/d/1uPX38qqEastYhp7_iH3MbHB0PSXP6lDc/view?usp=share_link) trained on multiscale trigonometric coefficient in section 4.2 with resolution=256.
- [FNO_multiscale_res256.pt](https://drive.google.com/file/d/1MZAIQhBjVh0-ja-Q6vi17kxYl9X5pKTw/view?usp=share_link) trained on multiscale trigonometric coefficient by FNO with resolution=256.


Put them in the ./models folder.
